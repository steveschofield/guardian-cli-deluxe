# Full Vulnerability Scan Workflow
# Combines network, web, and application security testing
# Includes comprehensive SSL/TLS scanning with all new security tools

name: full_vuln_scan
description: Full vulnerability scan combining network and web security testing

whitebox:
  enabled_if_source: true
  tools:
    - semgrep
    - trivy
    - gitleaks
    - trufflehog
  extract_attack_surface: true
  ai_analysis: true

steps:
  # ─── Network Discovery ───
  - name: port_scan
    type: tool
    tool: nmap
    objective: "Comprehensive port scan and service enumeration"
    parameters:
      scan_type: "-sV -sC"

  - name: http_discovery
    type: tool
    tool: httpx
    objective: "Discover web services and fingerprint technologies"
    parameters:
      tech_detect: true

  # ─── SSL/TLS & Transport Security ───
  - name: ssl_tls_scan
    type: tool
    tool: testssl
    objective: "Comprehensive SSL/TLS vulnerability testing"
    parameters:
      severity: "LOW"
    dependencies:
      - http_discovery

  - name: security_headers
    type: tool
    tool: headers
    objective: "Check HTTP security headers"
    parameters:
      follow_redirects: true
    dependencies:
      - http_discovery

  - name: cookie_security
    type: tool
    tool: cookie-analyzer
    objective: "Analyze cookie security configuration"
    parameters: {}
    dependencies:
      - http_discovery

  - name: cors_scan
    type: tool
    tool: cors-scanner
    objective: "Test for CORS misconfigurations"
    parameters: {}
    dependencies:
      - http_discovery

  # ─── Web Application Testing ───
  - name: waf_detection
    type: tool
    tool: wafw00f
    objective: "Detect WAF protections"
    parameters: {}
    dependencies:
      - http_discovery

  - name: tech_fingerprint
    type: tool
    tool: whatweb
    objective: "Identify web technologies"
    parameters: {}
    dependencies:
      - http_discovery

  - name: crawl
    type: tool
    tool: katana
    objective: "Crawl site for endpoint discovery"
    parameters: {}
    dependencies:
      - http_discovery

  - name: directory_discovery
    type: tool
    tool: feroxbuster
    objective: "Discover hidden paths"
    parameters:
      api_mode: true
    dependencies:
      - http_discovery

  # ─── Vulnerability Scanning ───
  - name: nuclei_scan
    type: tool
    tool: nuclei
    objective: "Template-based vulnerability scanning"
    parameters:
      severity: ["critical", "high", "medium"]
      tool_timeout: 900
    dependencies:
      - crawl

  - name: nikto_scan
    type: tool
    tool: nikto
    objective: "Web server vulnerability scan"
    parameters: {}
    dependencies:
      - http_discovery

  - name: sqli_scan
    type: tool
    tool: sqlmap
    objective: "SQL injection testing"
    parameters: {}
    dependencies:
      - crawl

  - name: xss_scan
    type: tool
    tool: dalfox
    objective: "XSS scanning"
    parameters:
      deep: true
    dependencies:
      - crawl

  - name: ssrf_scan
    type: tool
    tool: ssrf-scanner
    objective: "SSRF vulnerability testing"
    parameters: {}
    dependencies:
      - http_discovery

  - name: xxe_scan
    type: tool
    tool: xxe-scanner
    objective: "XXE injection testing"
    parameters: {}
    dependencies:
      - http_discovery

  - name: deserialization_scan
    type: tool
    tool: deserialization-scanner
    objective: "Insecure deserialization detection"
    parameters: {}
    dependencies:
      - http_discovery

  - name: auth_scan
    type: tool
    tool: auth-scanner
    objective: "Authentication bypass testing"
    parameters: {}
    dependencies:
      - http_discovery

  - name: idor_scan
    type: tool
    tool: idor-scanner
    objective: "IDOR and authorization testing"
    parameters: {}
    dependencies:
      - http_discovery

  - name: error_detection
    type: tool
    tool: error-detector
    objective: "Information disclosure via error messages"
    parameters: {}
    dependencies:
      - http_discovery

  # ─── Analysis & Reporting ───
  - name: analyze_vulns
    type: analysis
    agent: analyst
    objective: "Analyze all vulnerabilities and identify attack chains"

  - name: false_positive_check
    type: analysis
    agent: analyst
    objective: "Filter false positives and apply confidence scoring"

  - name: generate_report
    type: report
    agent: reporter
    format: html

settings:
  max_parallel_tools: 3
  require_confirmation: false
  save_intermediate: true
