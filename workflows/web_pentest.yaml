# Web Application Penetration Testing Workflow
# Focused on web application security assessment

name: web_application_pentest
description: Web application security testing workflow

steps:
  - name: http_discovery
    type: tool
    tool: httpx
    objective: "Discover web services and fingerprint technologies"
    parameters: {}

  - name: port_scan
    type: tool
    tool: nmap
    objective: "Identify additional services and exposed ports"
    parameters:
      ports: "80,443,8080,8443,3000,5000,8000"
      scan_type: "-sV -sC"

  - name: waf_detection
    type: tool
    tool: wafw00f
    objective: "Detect common WAF/CDN protections"
    parameters:
      find_all: true
    dependencies:
      - http_discovery

  - name: tls_headers_scan
    type: tool
    tool: sslyze
    objective: "Assess TLS posture and HTTP security headers"
    parameters:
      regular: false
    dependencies:
      - http_discovery

  - name: security_headers
    type: tool
    tool: headers
    objective: "Check common HTTP security headers"
    parameters:
      follow_redirects: true
      timeout: 10
    dependencies:
      - http_discovery

  - name: crawl
    type: tool
    tool: katana
    objective: "Crawl the site to enumerate endpoints"
    parameters: {}
    dependencies:
      - http_discovery

  - name: historical_urls
    type: tool
    tool: waybackurls
    objective: "Collect historical URLs for hidden endpoints"
    parameters: {}
    dependencies:
      - http_discovery

  - name: param_discovery
    type: tool
    tool: paramspider
    objective: "Find parameterized URLs for input discovery"
    parameters: {}
    dependencies:
      - http_discovery

  - name: param_probe
    type: tool
    tool: arjun
    objective: "Probe for hidden parameters on the main target"
    parameters: {}
    dependencies:
      - http_discovery

  - name: nikto_baseline_scan
    type: tool
    tool: nikto
    objective: "Run baseline web vulnerability scan"
    parameters:
      tuning: "x"
      timeout: 10
    dependencies:
      - http_discovery

  - name: vulnerability_scan
    type: tool
    tool: nuclei
    objective: "Scan for web vulnerabilities"
    parameters:
      severity: ["critical", "high", "medium"]
      templates_path: "~/nuclei-templates"
    dependencies:
      - crawl

  - name: api_schema_scan
    type: tool
    tool: schemathesis
    objective: "Fuzz OpenAPI/Swagger endpoints when a schema is available"
    parameters: {}
    dependencies:
      - http_discovery

  - name: xss_scan
    type: tool
    tool: dalfox
    objective: "Focused XSS scan on discovered URLs"
    parameters:
      deep: true
    dependencies:
      - crawl

  - name: zap_scan
    type: tool
    tool: zap
    objective: "Run a ZAP scan for broader web coverage"
    condition: zap_available
    parameters: {}
    dependencies:
      - crawl

  - name: analyze_web_vulns
    type: analysis
    agent: analyst
    objective: "Analyze web-specific vulnerabilities"
  
  - name: false_positive_check
    type: analysis
    agent: analyst
    objective: "Filter false positives"
  
  - name: generate_web_report
    type: report
    agent: reporter
    format: html

settings:
  max_parallel_tools: 3
  require_confirmation: false
  save_intermediate: true
